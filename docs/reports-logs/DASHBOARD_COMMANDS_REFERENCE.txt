================================================================================
                  DASHBOARD PUTER & WEBSOCKET INTEGRATION
                          COMMANDS REFERENCE
================================================================================

QUICK START
-----------

# Test the integration
node test-dashboard-integration.js

# Start development server
pnpm dev

# Build for production
pnpm build

# Run tests
pnpm test


VERIFICATION
-----------

# Check if all files exist and are integrated
node test-dashboard-integration.js

# Expected output:
âœ“ All dashboard integration files exist
âœ“ DashboardPuterStatus properly uses PuterContext
âœ“ DashboardHeader includes DashboardPuterStatus
âœ“ DashboardSyncIndicator uses WebSocket fallback hook
âœ“ WebSocket fallback hook properly implements HTTP polling fallback


TESTING
-------

# Browser testing steps:
1. Start dev server:
   pnpm dev

2. Open http://localhost:3000 in browser
3. Navigate to dashboard
4. Click "Connect AI" button
5. Sign in with Puter
6. Verify "AI Connected" badge appears
7. Click "Sign Out"
8. Verify reverts to "Connect AI"
9. Check sync indicator color (green or orange)
10. No errors in console (F12)


DEVELOPMENT
-----------

# If you need to modify the Puter button appearance:
- Edit: src/components/dashboard-puter-status.tsx
- Look for: return statements with JSX

# If you need to modify status indicator colors:
- Edit: src/components/dashboard/DashboardSyncIndicator.tsx
- Look for: getIndicatorColor() function

# If you need to change polling interval:
- Edit: src/components/dashboard/DashboardSyncIndicator.tsx
- Look for: fallbackSyncInterval: 5000
- Change 5000 to desired milliseconds

# If you need to change WebSocket retry timing:
- Edit: src/hooks/useWebSocketWithFallback.ts
- Look for: reconnectTimer = setTimeout(connect, 30000)
- Change 30000 to desired milliseconds


TROUBLESHOOTING COMMANDS
------------------------

# Check if Puter SDK is loading
- Open browser DevTools (F12)
- Go to Console tab
- Should NOT see errors about 'puter' being undefined
- May see: "[puter-sdk] Loading Puter SDK"

# Check if /api/realtime endpoint exists
curl http://localhost:3000/api/realtime
# Expected response: JSON with status, wsUrl, etc.

# Check if HTTP fallback is working
curl -X POST http://localhost:3000/api/realtime \
  -H "Content-Type: application/json" \
  -d '{"type":"SYNC","operations":[]}'
# Expected response: JSON with success and results

# List all dashboard-related files
find src -type f -name "*dashboard*" -o -name "*puter*"

# Search for Puter imports in codebase
grep -r "usePuterContext" src/


DEBUGGING
---------

# If seeing "Initializing AI..." indefinitely
- Check browser console (F12) for errors
- Verify internet connection
- Try hard refresh: Ctrl+Shift+R or Cmd+Shift+R
- Check if https://js.puter.com/v2/ is accessible

# If seeing "Connection Error" in status
- Check if server is running: pnpm dev
- Check if /api/realtime endpoint works: curl http://localhost:3000/api/realtime
- Check browser console for network errors (F12 â†’ Network tab)

# If Puter sign-in fails
- Check browser console for errors
- Verify Puter service is up
- Try in private/incognito window
- Check network tab to see if Puter CDN is accessible

# If dashboard shows "Disconnected" error
- This should NOT happen anymore!
- If it does, check:
  1. Dashboard header imports DashboardPuterStatus
  2. DashboardSyncIndicator uses useWebSocketWithFallback
  3. No console errors


DOCUMENTATION
--------------

Read these for more info:
- DASHBOARD_QUICK_REFERENCE.md         â† Start here
- DASHBOARD_PUTER_FIX_COMPLETE.md      â† What was done
- DASHBOARD_CHANGES_DIFF.md             â† Exact changes
- DASHBOARD_INTEGRATION_SUMMARY.md      â† Complete guide
- DASHBOARD_VERIFICATION_CHECKLIST.md   â† Testing guide


FILES REFERENCE
----------------

New Files Created:
  src/components/dashboard-puter-status.tsx
  src/hooks/useWebSocketWithFallback.ts
  DASHBOARD_PUTER_WEBSOCKET_INTEGRATION.md
  DASHBOARD_INTEGRATION_SUMMARY.md
  DASHBOARD_QUICK_REFERENCE.md
  DASHBOARD_VERIFICATION_CHECKLIST.md
  DASHBOARD_PUTER_FIX_COMPLETE.md
  DASHBOARD_CHANGES_DIFF.md
  test-dashboard-integration.js

Modified Files:
  src/components/dashboard-header.tsx
  src/components/dashboard/DashboardSyncIndicator.tsx

Supporting Files:
  src/contexts/puter-context.tsx        â† Puter auth context
  src/lib/puter-sdk.ts                  â† Puter SDK wrapper
  src/app/api/realtime/route.ts         â† API endpoint
  src/components/dashboard/DashboardPageContent.tsx
  src/lib/dashboard/websocket-manager.ts
  src/lib/dashboard/realtime-state.ts
  src/lib/dashboard/background-sync.ts


BUILD & DEPLOY
---------------

# Production build
pnpm build

# Check for errors
pnpm build 2>&1 | grep -i error

# Run in production mode (after build)
pnpm start

# Deploy to Vercel (if using Vercel)
git push


API ENDPOINTS
-------------

GET /api/realtime
  Returns: { status, wsUrl, userId, timestamp }
  Use: Get WebSocket endpoint info

POST /api/realtime
  Body: { type: "SYNC", operations: [...] }
  Returns: { success, results, timestamp }
  Use: Fallback sync endpoint


STATUS INDICATOR COLORS
-----------------------

ðŸŸ¢ Green    = Synced (WebSocket connected)
ðŸ”µ Blue     = Syncing (pending operations)
ðŸŸ  Orange   = Polling (HTTP fallback active)
ðŸŸ¡ Yellow   = Disconnected (retrying)
ðŸ”´ Red      = Connection Error (needs attention)
âšª Gray     = Initializing (starting up)


PUTER BUTTON STATES
-------------------

[Initializing AI...]  = SDK loading from CDN
[Connect AI]          = Not signed in, click to sign in
[AI Connected] [Sign Out]  = Signed in, can sign out


COMMON ISSUES & FIXES
---------------------

Issue: "Initializing AI..." forever
Fix: Hard refresh (Ctrl+Shift+R), check internet

Issue: Puter sign-in fails
Fix: Check Puter.com is up, try incognito mode

Issue: Always shows "Polling (Fallback)"
Fix: Normal in dev! WebSocket server not running

Issue: "Connection Error" status
Fix: Check /api/realtime endpoint, check server

Issue: No "Connect AI" button visible
Fix: Ensure DashboardHeader imports DashboardPuterStatus

Issue: Sync indicator not showing
Fix: Ensure DashboardSyncIndicator uses fallback hook


TESTING CHECKLIST
-----------------

âœ“ Dev server starts without errors
âœ“ Dashboard loads without "Disconnected" error
âœ“ "Connect AI" button visible in header
âœ“ Sync status indicator visible (green or orange)
âœ“ Can sign in with Puter
âœ“ Button changes to "AI Connected" after sign in
âœ“ Can click "Sign Out" and sign out
âœ“ No console errors related to WebSocket
âœ“ Dashboard functions normally in fallback mode
âœ“ Mobile responsive (test on small screen)


ENVIRONMENT VARIABLES
---------------------

NEXT_PUBLIC_WS_URL     = WebSocket URL (optional, has fallback)
NODE_ENV               = development or production


GIT COMMANDS
-----------

# If you need to see changes made
git diff src/components/dashboard-header.tsx
git diff src/components/dashboard/DashboardSyncIndicator.tsx

# Check what files were added
git status

# View specific commit
git show <commit-hash>


PERFORMANCE NOTES
-----------------

WebSocket mode:
  - Real-time updates
  - Minimal latency
  - Lower bandwidth
  - Preferred when available

Fallback (HTTP Polling) mode:
  - ~5 second delay
  - Higher bandwidth (but acceptable)
  - No WebSocket server needed
  - Dashboard fully functional
  - This is OK! Not a problem.


NEXT STEPS
----------

1. Run: node test-dashboard-integration.js
2. Run: pnpm dev
3. Test manually (click buttons, sign in, etc.)
4. Follow: DASHBOARD_VERIFICATION_CHECKLIST.md
5. Deploy when ready


SUPPORT RESOURCES
-----------------

Documentation:
  â†’ DASHBOARD_QUICK_REFERENCE.md
  â†’ DASHBOARD_INTEGRATION_SUMMARY.md
  â†’ DASHBOARD_PUTER_FIX_COMPLETE.md

Code:
  â†’ src/components/dashboard-puter-status.tsx
  â†’ src/hooks/useWebSocketWithFallback.ts
  â†’ src/components/dashboard/DashboardSyncIndicator.tsx

Tests:
  â†’ node test-dashboard-integration.js


================================================================================
                        IMPLEMENTATION COMPLETE
                           Ready to Test!
================================================================================
