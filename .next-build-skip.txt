# Workaround for Next.js 16 Turbopack workUnitAsyncStorage issue
# This file documents the Next.js 16 build issue we're working around

## Issue
Next.js 16.0.3 with Turbopack encounters a workUnitAsyncStorage error during static generation
of client components that use dynamic rendering features.

## Error
Error [InvariantError]: Invariant: Expected workUnitAsyncStorage to have a store. This is a bug in Next.js.

## Affected Pages
- /(app)/outline
- /(app)/admin/institutions
- /(app)/originality-check
- /(app)/methodology
- /_global-error

## Solution Applied
1. Removed `staticGenerationRetryCount: 1` from next.config.ts
2. Removed `scrollRestoration: true` and set `clientTraceMetadata: []`
3. Added `export const dynamic = "force-dynamic"` to (app) layout
4. Fixed global-error to not force-dynamic (it caused prerender errors)

## Root Cause
This is a known Next.js 16 + Turbopack issue where the AsyncLocalStorage for workUnit tracking
is not properly initialized during prerendering of dynamic client components.

## Temporary Workaround (if needed)
Use webpack instead of Turbopack by setting NEXT_SKIP_TURBOPACK=1 environment variable

## Status
Build is blocked on this issue - will need Next.js update or environment variable workaround
